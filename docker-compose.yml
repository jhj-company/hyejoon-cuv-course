# ===============================
# ğŸš€ Docker Compose ì‹¤í–‰/ê´€ë¦¬ ëª…ë ¹ì–´
# -------------------------------
# ì „ì²´ ì„œë¹„ìŠ¤ ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ)
#   docker compose up -d
#
# ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ì§€ + ë„¤íŠ¸ì›Œí¬ ì œê±° (ë°ì´í„° ìœ ì§€)
#   docker compose down
#
# ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ì§€ + ë³¼ë¥¨/ë°ì´í„°ê¹Œì§€ ì‚­ì œ (ì£¼ì˜!)
#   docker compose down -v
#
# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ì‹œì‘ (ì˜ˆ: mysql)
#   docker compose restart mysql
#
# ë¡œê·¸ í™•ì¸ (ì˜ˆ: app container name: hjcuv-redis)
#   docker logs -f hjcuv-redis
#
# ë„ì»¤ ë‚´ë¶€ bash ì ‘ì†
#   docker exec -it <container_name> bash
#
# Redis ping í™•ì¸
#   docker exec -it hjcuv-redis redis-cli ping
# ===============================

version: "3.8"
services:
  mysql:
    image: mysql:8.0
    container_name: hjcuv-mysql
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: hjcuv
      MYSQL_USER: hjcuv
      MYSQL_PASSWORD: 1234
    ports:
      - "3307:3306"
    volumes:
      - mysql_data:/var/lib/mysql # MySQL ê³µì‹ ê¸°ë³¸ ë°ì´í„° ë””ë ‰í† ë¦¬

  mysql-dev:
    image: mysql:8.0
    container_name: hjcuv-mysql-dev
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: hjcuv-dev
      MYSQL_USER: hjcuv
      MYSQL_PASSWORD: 1234
    ports:
      - "3308:3306"
    volumes:
      - mysql_dev_data:/var/lib/mysql
      - ./src/test/resources/dev_db_init.sql:/docker-entrypoint-initdb.d/dev_db_init.sql

  redis-lock:
    image: redis:7.4
    container_name: hjcuv-redis-lock
    command: [ "redis-server", "--appendonly", "yes", "--appendfsync", "everysec", "--maxmemory-policy", "noeviction" ]
    ports:
      - "6379:6379"
    volumes:
      - redis_lock_data:/data

  redis-cache:
    image: redis:7.4
    container_name: hjcuv-redis-cache
    command: [ "redis-server", "--appendonly", "no", "--maxmemory-policy", "allkeys-lru" ]
    ports:
      - "6380:6379"
    volumes:
      - redis_cache_data:/data

  elastic-search:
    image: elasticsearch:9.1.4
    container_name: hjcuv-elasticsearch
    environment:
      # ë‹¨ì¼ ë…¸ë“œë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
      - discovery.type=single-node
      # ë³´ì•ˆ ê¸°ëŠ¥ì„ êº¼ì„œ, ID/PW ì—†ì´ ë°”ë¡œ APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
      - xpack.security.enabled=false
      # JVM í™ ë©”ëª¨ë¦¬ë¥¼ 2GBë¡œ ê³ ì •í•©ë‹ˆë‹¤. (ë‚´ PCì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ê³¼ë„í•˜ê²Œ ì“°ì§€ ì•Šë„ë¡)
      - "ES_JAVA_OPTS=-Xms2g -Xmx2g"
    ports:
      - "9200:9200"
    volumes:
      - es_data:/usr/share/elasticsearch/data

volumes:
  mysql_data:
  redis_lock_data:
  redis_cache_data:
  mysql_dev_data:
  es_data:
