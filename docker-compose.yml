# ===============================
# ğŸš€ Docker Compose ì‹¤í–‰/ê´€ë¦¬ ëª…ë ¹ì–´
# -------------------------------
# ì „ì²´ ì„œë¹„ìŠ¤ ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ)
#   docker compose up -d
#
# ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ì§€ + ë„¤íŠ¸ì›Œí¬ ì œê±° (ë°ì´í„° ìœ ì§€)
#   docker compose down
#
# ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ì§€ + ë³¼ë¥¨/ë°ì´í„°ê¹Œì§€ ì‚­ì œ (ì£¼ì˜!)
#   docker compose down -v
#
# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ì‹œì‘ (ì˜ˆ: mysql)
#   docker compose restart mysql
#
# ë¡œê·¸ í™•ì¸ (ì˜ˆ: app container name: hjcuv-redis)
#   docker logs -f hjcuv-redis
#
# ë„ì»¤ ë‚´ë¶€ bash ì ‘ì†
#   docker exec -it <container_name> bash
#
# Redis ping í™•ì¸
#   docker exec -it hjcuv-redis redis-cli ping
# ===============================

version: "3.8"
services:
  mysql:
    image: mysql:8.0
    container_name: hjcuv-mysql
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: hjcuv
      MYSQL_USER: hjcuv
      MYSQL_PASSWORD: 1234
    ports:
      - "3307:3306"
    volumes:
      - mysql_data:/var/lib/mysql # MySQL ê³µì‹ ê¸°ë³¸ ë°ì´í„° ë””ë ‰í† ë¦¬

  redis:
    image: redis:7.4
    container_name: hjcuv-redis
    # === AOF ì„¤ì • (ëª¨ë“  ê¸°ë¡[=ë™ì˜ìƒ]) ===
    # * `--appendonly yes`: AOF(Append Only File) ê¸°ëŠ¥ í™œì„±í™” / Redisê°€ ì²˜ë¦¬í•œ ëª¨ë“  write ëª…ë ¹ì„ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡, ì„œë²„ ì¬ì‹œì‘ ì‹œ ë°ì´í„° ë³µêµ¬
    # * `--appendfsync everysec`: AOF íŒŒì¼ì— ì–¼ë§ˆë‚˜ ìì£¼ fsync(ë””ìŠ¤í¬ì— ê¸°ë¡)í• ì§€ ì„¤ì •, everysecëŠ” ë§¤ì´ˆë§ˆë‹¤ ë™ê¸°í™”
    #    * `always`: ë§¤ ëª…ë ¹ë§ˆë‹¤ ë””ìŠ¤í¬ ê¸°ë¡ (ê°€ì¥ ì•ˆì „í•˜ì§€ë§Œ ì„±ëŠ¥ ì €í•˜)
    #    * `everysec`: ë§¤ì´ˆë§ˆë‹¤ ë””ìŠ¤í¬ ê¸°ë¡ (ê· í˜• ì¡íŒ ì˜µì…˜, ì¼ë°˜ì ìœ¼ë¡œ ê¶Œì¥)
    #    * `no`: OSê°€ ì•Œì•„ì„œ ë””ìŠ¤í¬ ê¸°ë¡ (ìµœê³  ì„±ëŠ¥, ë°ì´í„° ì†ì‹¤ ìœ„í—˜)
    # === RDB ì„¤ì • (ìŠ¤ëƒ…ìƒ·[=ì‚¬ì§„]) ===
    # * --save 60 1: RDB ìŠ¤ëƒ…ìƒ· ì„¤ì •
    #    * `save <seconds> <changes> í˜•ì‹`: <seconds> ë™ì•ˆ <changes> ë²ˆ ì´ìƒ ë°ì´í„°ê°€ ë°”ë€Œë©´ RDB ë¤í”„(dump.rdb) ìƒì„±
    #    * `60 1`: 60ì´ˆ ë™ì•ˆ 1ë²ˆ ì´ìƒì˜ ë³€ê²½ì´ ìˆìœ¼ë©´ ìŠ¤ëƒ…ìƒ· ìƒì„±
    command: ["redis-server", "--appendonly", "yes", "--appendfsync", "everysec", "--save", "60", "1"]
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data # Redis ê³µì‹ ê¸°ë³¸ ë°ì´í„° ë””ë ‰í† ë¦¬

volumes:
  mysql_data:
  redis_data:
